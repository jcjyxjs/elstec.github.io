---
layout: post
title: 群晖虚拟机安装lede软路由
slug: qhlede
date: 2020-03-01 12:50
status: publish
author: jcjyxjs
categories:
  - lede
tags:
  - lede
  - 群晖
  - 软路由
  - openwrt
excerpt: 插件用起来真爽，不过可惜了我的机器只能做旁路由。
---

# 我想说的

在几个月前我的k2p原地爆炸之后，我给它刷了个系统就再也进不去了。没办法只能换路由器。买了个菊花的路由器才突然想起来，菊花的路由器不能刷机。<span><img style="display:inline" src="https://cdn.elstec.cn/%E5%93%94%E5%93%A9%E5%93%94%E5%93%A9%E8%A1%A8%E6%83%85%E5%8C%85/murm.png" width="56" height="56"></span>近期我的硬盘刚到，就想到还有蜗牛星际这个nas，我想用群晖，但是又想刷lede。就在想可不可以在群晖虚拟机下装lede，虽然只有旁路由，但是lede和群晖同时有岂不是美滋滋。

# 过程

### 一、安装虚拟机

首先打开群辉的套件中心，找到 `Virtual Machine Manager` 然后安装并打开。

![](https://cdn.elstec.cn/18/1.png?imageMogr2/format/webp/interlace/1/quality/100)

下载lede虚拟机镜像， [点我](http://firmware.koolshare.cn/LEDE_X64_fw867/%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%BD%AC%E7%9B%98%E6%88%96PE%E4%B8%8B%E5%86%99%E7%9B%98%E4%B8%93%E7%94%A8/) 

我下载的是 `openwrt-koolshare-mod-v2.31-r10822-50aa0525d1-x86-64-uefi-gpt-squashfs.img.gz` 

![](https://cdn.elstec.cn/18/2.png?imageMogr2/format/webp/interlace/1/quality/100)

下载完成之后解压，得到img镜像文件。

![](https://cdn.elstec.cn/18/3.png?imageMogr2/format/webp/interlace/1/quality/100)

再次回到群辉，在 `Virtual Machine Manager` 中，依次点击 `映像→新增` 上传刚刚解压的img镜像文件。

![](https://cdn.elstec.cn/18/4.png?imageMogr2/format/webp/interlace/1/quality/100)

上传完成之后，依次点击 `虚拟机→新增旁边的下三角，点击导入` 。选择 `从硬盘映像导入` ，选择刚刚上传的镜像然后下一步。

![](https://cdn.elstec.cn/18/5.png?imageMogr2/format/webp/interlace/1/quality/100)

存储位置随便你，然后到配置常用规格，由于我是蜗牛星际的B单，内存只有4GB所以就选1H1G，然后下一步。

![](https://cdn.elstec.cn/18/6.png?imageMogr2/format/webp/interlace/1/quality/100)

一直下一步直到其他设置，不要选择自动启动，有些设备会报错。

![](https://cdn.elstec.cn/18/7.png?imageMogr2/format/webp/interlace/1/quality/100)

然后一直下一步直到完成导入，点击上方的开机即可。

#### 关于网络配置

网络可以新建一个，也可以用创建虚拟机时候的默认网络。

点击 `网络→新增` 就可以新建一个网络了。

![](https://cdn.elstec.cn/18/7-1.png?imageMogr2/format/webp/interlace/1/quality/100)

输入名称并绑定主机下一步即可。

![](https://cdn.elstec.cn/18/7-2.png?imageMogr2/format/webp/interlace/1/quality/100)


### 二、配置虚拟机IP

开机之后不能直接连接，因为lede默认的IP是 `192.168.1.1` ，可能会和大部分用户的默认网关地址冲突，所以要先改IP。首先点击上方的连接。然后会弹出一个窗口，看到下面的状态就代表启动完成了。页面没变化敲几下回车就可以了。

![](https://cdn.elstec.cn/18/8.png?imageMogr2/format/webp/interlace/1/quality/100)

终端输入如下命令

```shell
vi etc/config/network
```

随后找到 `lan` 的设置。按下键盘的 `Ins` ，把默认的 `192.168.1.1` 改成自己想要的IP ，随后按下 `Esc` 退出编辑模式，按 `:wq` 保存并退出。

![](https://cdn.elstec.cn/18/9.png?imageMogr2/format/webp/interlace/1/quality/100)

然后输入 `reboot` 重启生效。

### 三、配置Openwrt

浏览器打开刚刚改的IP，默认账号是 `root` ，默认密码是 `koolshare` 

打开右侧的 `系统→管理权` 更改web密码。

![](https://cdn.elstec.cn/18/10.png?imageMogr2/format/webp/interlace/1/quality/100)

然后点击右侧 `网络→接口` 删除WAN和WAN6。（由于我要做旁路由所以删除这两个）

![](https://cdn.elstec.cn/18/10-1.png?imageMogr2/format/webp/interlace/1/quality/100)

找到LAN点击编辑。找到IPV4网关和IPV4广播，进行对应的配置。

![](https://cdn.elstec.cn/18/11.png?imageMogr2/format/webp/interlace/1/quality/100)

然后在当前页面最下方找到 `DHCP服务器→基本设置` 勾选忽略此接口。

![](https://cdn.elstec.cn/18/12.png?imageMogr2/format/webp/interlace/1/quality/100)

至此，lede旁路由就配置完成了，能够做旁路由正常上网。插件什么的有酷软可以自己装也可以网上找安装包离线安装。

![](https://cdn.elstec.cn/18/13.png?imageMogr2/format/webp/interlace/1/quality/100)

### Openwrt半双工配置全双工

在OP首页可以看到默认 `eth0` 是半双工。

![](https://cdn.elstec.cn/18/14.png?imageMogr2/format/webp/interlace/1/quality/100)

这时候需要先把lede关掉。在群晖 `Virtual Machine Manager→虚拟机` 中，点击上方的编辑，找到网络。

![](https://cdn.elstec.cn/18/15.png?imageMogr2/format/webp/interlace/1/quality/100)

编辑绑定虚拟机的网络，就是点那个齿轮。把型号改成 `e1000` 。

![](https://cdn.elstec.cn/18/16.png?imageMogr2/format/webp/interlace/1/quality/100)

然后开机看到就是全双工了。

![](https://cdn.elstec.cn/18/17.png?imageMogr2/format/webp/interlace/1/quality/100)
